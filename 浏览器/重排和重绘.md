# 重排和重绘

简单概念：重排是“调整房子结构”，重绘是“给墙面刷漆”

## 核心概念

1. HTML 解析为 DOM 树。
2. CSS 解析为 CSSOM 树。
3. DOM 和 CSSOM 合并为 渲染树 (Render Tree)。
4. 布局 (Layout/Reflow)：计算每个节点在屏幕上的确切位置和大小。
5. 绘制 (Paint/Repaint)：将像素填充到屏幕上（颜色、阴影等）。
6. 合成 (Composite)：将图层组合并显示。

## 重排 (Reflow / Layout)

也称为“回流”。当渲染树中的一部分（或全部）因为元素的规模尺寸、布局、隐藏等改变而需要重新构建时，就称为重排。

- 关注点：几何属性（位置、大小）。
- 代价：非常昂贵。浏览器需要重新计算元素的位置和几何形状，甚至影响周围或整个页面的元素

## 重绘 (Repaint)

当渲染树中的一些元素需要更新属性，而这些属性只是影响元素的外观、风格，而不影响布局（如颜色、背景色）时，就称为重绘。

- 关注点：外观属性（颜色、风格）。
- 代价：相对较小（但也消耗资源）。

**黄金法则**：重排必定引发重绘，但重绘不一定引发重排。 (因为位置变了，肯定要重新画；但颜色变了，位置不一定变。)

## 什么操作会触发它们？

### 触发重排 (Reflow) 的操作：

重排的开销很大，以下操作应尽量避免频繁触发：

1. DOM 操作： 添加、删除、移动 DOM 节点。
2. 尺寸变化： 修改 width, height, padding, margin, border。
3. 内容变化： 文字改变（输入框打字）、图片加载完成（大小变化）。
4. 窗口变化： 调整浏览器窗口大小 (Resize)。
5. CSS 伪类激活： 如 :hover 改变了元素大小。
6. 读取特定的布局属性（强制同步布局）：
   - 当你读取 offsetTop, offsetLeft, offsetWidth, offsetHeight, scrollTop/Left/Width/Height, clientTop/Left/Width/Height 或调用 getComputedStyle() 时，浏览器为了返回最新值，会强制立即执行一次重排队列。

### 触发重绘 (Repaint) 的操作：

1. 修改 color, background-color。
2. 修改 visibility (从 hidden 到 visible)。
3. 修改 outline, box-shadow。
